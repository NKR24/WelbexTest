import{ssrElement as R,escape as h,mergeProps as B,ssr as p,renderToStream as O,ssrHydrationKey as g,createComponent as u,ssrAttribute as _,isServer as U,getRequestEvent as q,useAssets as j,NoHydration as k,HydrationScript as K,Hydration as z}from"solid-js/web";import{lazy as G,createComponent as J,sharedConfig as C,onCleanup as V,ErrorBoundary as D}from"solid-js";import{provideRequestEvent as X}from"solid-js/web/storage";import{H3Event as S,setResponseStatus as Y,getResponseHeader as Q,setResponseHeader as Z,appendResponseHeader as ee,sendRedirect as te,getCookie as ne,setCookie as re,setHeader as se,removeResponseHeader as oe,getRequestURL as ae,getRequestIP as ie,getRequestWebStream as ce,eventHandler as le}from"h3";import{AsyncLocalStorage as ue}from"node:async_hooks";import{W as de}from"./assets/Wrapper-042a7d11.js";import"clsx";function fe(e={}){let t,n=!1;const r=s=>{if(t&&t!==s)throw new Error("Context conflict")};let o;if(e.asyncContext){const s=e.AsyncLocalStorage||globalThis.AsyncLocalStorage;s?o=new s:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const a=()=>{if(o&&t===void 0){const s=o.getStore();if(s!==void 0)return s}return t};return{use:()=>{const s=a();if(s===void 0)throw new Error("Context is not available");return s},tryUse:()=>a(),set:(s,i)=>{i||r(s),t=s,n=!0},unset:()=>{t=void 0,n=!1},call:(s,i)=>{r(s),t=s;try{return o?o.run(s,i):i()}finally{n||(t=void 0)}},async callAsync(s,i){t=s;const c=()=>{t=s},l=()=>t===s?c:void 0;x.add(l);try{const f=o?o.run(s,i):i();return n||(t=void 0),await f}finally{x.delete(l)}}}}function pe(e={}){const t={};return{get(n,r={}){return t[n]||(t[n]=fe({...e,...r})),t[n],t[n]}}}const v=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:typeof window<"u"?window:{},T="__unctx__",he=v[T]||(v[T]=pe()),me=(e,t={})=>he.get(e,t),E="__unctx_async_handlers__",x=v[E]||(v[E]=new Set);function ge(e){let t;const n=M(e),r={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(n,{...r,body:e.node.req.body}):new Request(n,{...r,get body(){return t||(t=xe(e),t)}})}function ye(e){return e.web??={request:ge(e),url:M(e)},e.web.request}function ve(){return _e()}const L=Symbol("$HTTPEvent");function Re(e){return typeof e=="object"&&(e instanceof S||e?.[L]instanceof S||e?.__is_event__===!0)}function d(e){return function(...t){let n=t[0];if(Re(n))t[0]=n instanceof S||n.__is_event__?n:n[L];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(n=ve(),!n)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(n)}return e(...t)}}const M=d(ae),we=d(ie),b=d(Y),Se=d(Q),w=d(Z),be=d(ee),$e=d(te),Ce=d(ne),Te=d(re),Ee=d(se),xe=d(ce),Ae=d(oe);function He(){return me("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:ue})}function _e(){return He().use().event}const P=Symbol("h3Event"),y=Symbol("fetchEvent"),qe={get(e,t){return t===y?e:e[t]??e[P][t]}};function ke(e){const t=ye(e);return new Proxy({request:t,clientAddress:we(e),locals:{},[P]:e},qe)}function Le(e){if(!e[y]){const t=ke(e);e[y]=t}return e[y]}function Me(e){e.forEach(t=>{if(!t.attrs.href)return;let n=document.head.querySelector(`link[href="${t.attrs.href}"]`);n||(n=document.createElement("link"),n.setAttribute("rel","preload"),n.setAttribute("as","style"),n.setAttribute("href",t.attrs.href),document.head.appendChild(n))})}var Pe=" ";const Ne={style:e=>R("style",e.attrs,()=>h(e.children),!0),link:e=>R("link",e.attrs,void 0,!0),script:e=>e.attrs.src?R("script",B(()=>e.attrs,{get id(){return e.key}}),()=>p(Pe),!0):null};function $(e){let{tag:t,attrs:{key:n,...r}={key:void 0},children:o}=e;return Ne[t]({attrs:r,key:n,children:o})}function Ie(e,t,n,r="default"){return G(async()=>{{const a=(await e.import())[r],i=(await t.inputs?.[e.src].assets()).filter(l=>l.tag==="style"||l.attrs.rel==="stylesheet");return typeof window<"u"&&Me(i),{default:l=>[...i.map(f=>$(f)),J(a,l)]}}})}const N=[{type:"page",$component:{src:"src/routes/[...404].tsx?pick=default&pick=$css",build:()=>import("./_...404_.js"),import:()=>import("./_...404_.js")},path:"/*404",filePath:"/home/fedor/Git/WelbexTest/Version/src/routes/[...404].tsx"},{type:"page",$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("./index.js"),import:()=>import("./index.js")},path:"/",filePath:"/home/fedor/Git/WelbexTest/Version/src/routes/index.tsx"}],Fe=Oe(N.filter(e=>e.type==="page")),We=Ue(N.filter(e=>e.type==="api"));function Be(e,t){const n=e.replace("","").split("/").filter(Boolean);e:for(const r of We){const o=r.matchSegments;if(n.length<o.length||!r.wildcard&&n.length>o.length)continue;for(let i=0;i<o.length;i++){const c=o[i];if(c&&n[i]!==c)continue e}const a=r[`$${t}`];if(a==="skip"||a===void 0)return;const s={};for(const{type:i,name:c,index:l}of r.params)i===":"?s[c]=n[l]:s[c]=n.slice(l).join("/");return{handler:a,params:s}}}function Oe(e){function t(n,r,o,a){const s=Object.values(n).find(i=>o.startsWith(i.id+"/"));return s?(t(s.children||(s.children=[]),r,o.slice(s.id.length)),n):(n.push({...r,id:o,path:o.replace(/\/\([^)/]+\)/g,"")}),n)}return e.sort((n,r)=>n.path.length-r.path.length).reduce((n,r)=>t(n,r,r.path,r.path),[])}function Ue(e){return e.flatMap(t=>I(t.path).map(r=>({...t,path:r}))).map(je).sort((t,n)=>n.score-t.score)}function I(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),r=e.slice(t.index+t[0].length);const o=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)o.push(n+=t[1]),r=r.slice(t[0].length);return I(r).reduce((a,s)=>[...a,...o.map(i=>i+s)],[])}function je(e){const t=e.path.split("/").filter(Boolean),n=[],r=[];let o=0,a=!1;for(const[s,i]of t.entries())if(i[0]===":"){const c=i.slice(1);o+=3,n.push({type:":",name:c,index:s}),r.push(null)}else i[0]==="*"?(o-=1,n.push({type:"*",name:i.slice(1),index:s}),a=!0):(o+=4,i.match(/^\(.+\)$/)||r.push(i));return{...e,score:o,params:n,matchSegments:r,wildcard:a}}function Ke(){function e(n){return{...n,...n.$$route?n.$$route.require().route:void 0,metadata:{...n.$$route?n.$$route.require().route.metadata:{},filesystem:!0},component:Ie(n.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:n.children?n.children.map(e):void 0}}return Fe.map(e)}function ze(e){const t=Ce(e,"flash");if(!t)return;let n=JSON.parse(t);if(!n||!n.result)return[];const r=[...n.input.slice(0,-1),new Map(n.input[n.input.length-1])];return Te(e,"flash","",{maxAge:0}),{url:n.url,result:n.error?new Error(n.result):n.result,input:r}}async function F(e){const t=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,w(e,"Content-Type","text/html"),Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],initialSubmission:ze(e),routes:Ke(),components:{status:r=>(b(e,r.code,r.text),()=>!e.handled&&b(e,200)),header:r=>(r.append?be(e,r.name,r.value):w(e,r.name,r.value),()=>{if(e.handled)return;let o=Se(e,r.name);Array.isArray(o)||(o=[o]);const a=o.indexOf(r.value);a!==-1&&o.splice(a,1),o.length?w(e,r.name,o):Ae(e,r.name)})},$islands:new Set})}function Ge(e,t={}){return le({onRequest:t.onRequest,onBeforeResponse:t.onBeforeResponse,handler:n=>{const r=Le(n);return X(r,async()=>{const o=Be(new URL(r.request.url).pathname,r.request.method);if(o){const m=(await o.handler.import())[r.request.method];return r.params=o.params,C.context={event:r},await m(r)}const a=await F(r);let s={...t};if(s.onCompleteAll){const f=s.onCompleteAll;s.onCompleteAll=m=>{H(a)(m),f(m)}}else s.onCompleteAll=H(a);if(s.onCompleteShell){const f=s.onCompleteShell;s.onCompleteShell=m=>{A(a,n)(),f(m)}}else s.onCompleteShell=A(a,n);const i=O(()=>(C.context.event=a,e(a)),s);if(a.response&&a.response.headers.get("Location"))return $e(r,a.response.headers.get("Location"));const{writable:c,readable:l}=new TransformStream;return i.pipeTo(c),l})}})}function A(e,t){return()=>{e.response&&e.response.headers.get("Location")&&(b(t,302),Ee(t,"Location",e.response.headers.get("Location")))}}function H(e){return({write:t})=>{const n=e.response&&e.response.headers.get("Location");n&&t(`<script>window.location="${n}"<\/script>`)}}function Je(e,t={}){return Ge(e,{...t,createPageEvent:F})}var Ve=["<title",">WELBEX</title>"];function De(){return[p(Ve,g()),u(de,{})]}const Xe={};var Ye=["<div",">","</div>"];function Qe(){return p(Ye,g()+_("class",h(Xe.main,!0),!1),h(u(De,{})))}function Ze(e){if(U){const t=q();t&&V(t.components.status(e))}return null}function et(e){return u(D,{get fallback(){return u(Ze,{code:500})},get children(){return e.children}})}var tt=["<script",">","<\/script>"],nt=["<script",' type="module" async',"><\/script>"];const rt=p("<!DOCTYPE html>");function W(e,t,n=[]){for(let r=0;r<t.length;r++){const o=t[r];if(o.path!==e[0].path)continue;let a=[...n,o];if(o.children){const s=e.slice(1);if(s.length===0||(a=W(s,o.children,a),!a))continue}return a}}function st(e){const t=q();let n=[];return Promise.resolve().then(async()=>{if(t.routerMatches&&t.routerMatches[0]){const r=[...t.routerMatches[0]];for(;r.length&&(!r[0].metadata||!r[0].metadata.filesystem);)r.shift();const o=r.length&&W(r,t.routes);if(o)for(let a=0;a<o.length;a++){const s=o[a],c=await globalThis.MANIFEST.client.inputs[s.$component.src].assets();n.push.apply(n,c)}else console.warn("No route matched for preloading js assets")}n=[...new Map(n.map(r=>[r.attrs.key,r])).values()].filter(r=>r.attrs.rel==="modulepreload"&&!t.assets.find(o=>o.attrs.key===r.attrs.key))}),j(()=>n.length?n.map(r=>$(r)):void 0),u(k,{get children(){return[rt,u(e.document,{get assets(){return[u(K,{}),t.assets.map(r=>$(r))]},get scripts(){return[p(tt,g(),`window.manifest = ${JSON.stringify(t.manifest)}`),p(nt,g(),_("src",h(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]},get children(){return u(z,{get children(){return u(et,{get children(){return u(Qe,{})}})}})}})]}})}var ot=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],at=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const ht=Je(()=>u(st,{document:({assets:e,children:t,scripts:n})=>p(at,g(),u(k,{get children(){return p(ot,h(e))}}),h(t),h(n))}));export{ht as default};
